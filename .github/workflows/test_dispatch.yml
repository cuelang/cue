# Generated by internal/ci/ci_tool.cue; do not edit

name: Dispatch build branch
env:
  CUECKOO_PAT: ${{ secrets.cueckooPAT }}
defaults:
  run:
    shell: bash
on:
- repository_dispatch
jobs:
  create_build_branch:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Checkout ref
      run: |-
        git fetch https://cue-review.googlesource.com/cue ${{ github.event.client_payload.ref }}
        git checkout FETCH_HEAD
    - name: Create build branch
      run: |-
        git config user.email cueckoo@cuelang.org
        git config user.name cueckoo
        git config http.https://github.com/.extraheader "AUTHORIZATION basic $(echo cueckoo:$CUECKOO_PAT | base64)"
        ref=$(echo ${{ github.event.client_payload.ref }} | sed -e 's/\//_/g')
        branch="$(date -u +%Y%m%d%H%M%S)-${{ github.event.client_payload.changeID }}-${{ github.event.client_payload.commit }}-$ref"
        git checkout -b $branch
        git push origin $branch
